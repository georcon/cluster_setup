#!/usr/sbin/nft -f

#
# External Firewall temporary rules
#

flush ruleset

define extif				="ens160"
define intif				="ens192"

define dmz_net			= 10.1.1.0/24
define nat_subnets	= {$dmz_net}

#table filter {
#	chain input {
#		type filter hook input priority 0; policy drop; 
#		ct state established, related counter accept
#	}
#}

table ip nat {
	chain postrouting {
		type nat hook postrouting priority srcnat; policy accept;
		#ip daddr 127.0.0.53 accept;
		ip saddr {10.1.2.0/24, 10.1.1.0/24, 10.10.106.0/24, 10.10.10.0/24, 10.10.110.0/24, 10.10.112.0/24, 10.10.111.0/24, 10.10.113.0/24, 10.11.1.0/24, 10.10.107.0/24, 10.113.0.0/16} ip daddr != 127.0.0.1 oif "ens160" snat to 192.168.15.30
		#ip saddr {10.1.1.0/24,10.10.106.0/24} oif $extif masquerade;
	}

  chain prerouting {
    type nat hook prerouting priority -100;
    iif $extif udp dport {500, 4500} dnat 10.10.106.1
    iif $extif udp dport {53} dnat 10.1.2.31
    iif $extif tcp dport {53} dnat 10.1.2.31
		iif $extif tcp dport {80} dnat 10.1.1.41:80
		iif $extif tcp dport {443} dnat 10.1.1.41:443
	  iif $extif udp dport {1194} dnat 10.10.106.80:1194
	  iif $extif tcp dport {10001} dnat 10.10.106.1:22
		iif $extif tcp dport {10002} dnat 10.10.110.150:4172
		iif $extif udp dport {10002} dnat 10.10.110.150:4172
		iif $extif udp dport {10003} dnat 10.10.110.150:22443
		iif $extif tcp dport {10004} dnat 10.10.110.150:443
  }
}
